# Deribit Client

FastAPI-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Ü–µ–Ω –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç —Å –±–∏—Ä–∂–∏ Deribit —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø–æ–ª—É—á–µ–Ω–∏–µ–º —Ü–µ–Ω —á–µ—Ä–µ–∑ Celery.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ü–µ–Ω –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É (BTC_USD, ETH_USD)
- üìä –•—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –æ —Ü–µ–Ω–∞—Ö —Å Unix timestamp
- üöÄ –ë—ã—Å—Ç—Ä–æ–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ API –Ω–∞ FastAPI
- üìà –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ü–µ–Ω –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω—É –¥–∞—Ç
- üê≥ –ü–æ–ª–Ω–∞—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è —Å Docker Compose
- ‚úÖ –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ unit-—Ç–µ—Å—Ç—ã
- üîß –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å Alembic

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **Backend Framework**: FastAPI
- **–û—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á**: Celery + Redis
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: PostgreSQL
- **ORM**: SQLAlchemy (async)
- **HTTP –∫–ª–∏–µ–Ω—Ç**: aiohttp
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: pytest + pytest-asyncio
- **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è**: Docker + Docker Compose
- **–ú–∏–≥—Ä–∞—Ü–∏–∏**: Alembic

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–ª–µ–¥—É–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø–∞–º —á–∏—Å—Ç–æ–π —Å–ª–æ–∏—Å—Ç–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:

```
app/
‚îú‚îÄ‚îÄ api/              # API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ clients/          # –ö–ª–∏–µ–Ω—Ç—ã –≤–Ω–µ—à–Ω–∏—Ö API (Deribit)
‚îú‚îÄ‚îÄ database/         # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ë–î –∏ –º–µ–Ω–µ–¥–∂–µ—Ä
‚îú‚îÄ‚îÄ models/           # ORM –º–æ–¥–µ–ª–∏ SQLAlchemy
‚îú‚îÄ‚îÄ repositories/     # –°–ª–æ–π –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º
‚îú‚îÄ‚îÄ schemas/          # Pydantic —Å—Ö–µ–º—ã –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ services/         # –°–ª–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
‚îú‚îÄ‚îÄ tasks/            # –ó–∞–¥–∞—á–∏ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Celery
‚îî‚îÄ‚îÄ migrations/       # –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö Alembic
```

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone <repository-url>
cd deribitClient
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
cp .env.example .env
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `.env`, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:

```env
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_DB=crypto_prices

REDIS_HOST=redis
REDIS_PORT=6379

DERIBIT_API_URL=https://www.deribit.com/api/v2

CELERY_BEAT_SCHEDULE_INTERVAL=60
```
## –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Docker Compose

**–°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:**

```bash
docker-compose up -d --build
```

–≠—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç:
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL
- –ë—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π Redis
- –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (—Å–µ—Ä–≤–∏—Å init)
- FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–ø–æ—Ä—Ç 8000)
- Celery worker
- Celery beat –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API

### –î–æ—Å—Ç—É–ø–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

#### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Ü–µ–Ω

–ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —Ü–µ–Ω –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–∏–∫–µ—Ä–∞ —Å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π.

```http
GET /prices?ticker={TICKER}&limit={LIMIT}&offset={OFFSET}&date_from={DATE}&date_to={DATE}
```

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `ticker` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π): `BTC_USD` –∏–ª–∏ `ETH_USD`
- `limit` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ (1-1000, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 100)
- `offset` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –¥–ª—è –ø—Ä–æ–ø—É—Å–∫–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 0)
- `date_from` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –§–∏–ª—å—Ç—Ä –æ—Ç –¥–∞—Ç—ã (—Ñ–æ—Ä–º–∞—Ç ISO 8601)
- `date_to` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –§–∏–ª—å—Ç—Ä –¥–æ –¥–∞—Ç—ã (—Ñ–æ—Ä–º–∞—Ç ISO 8601)

**–ü—Ä–∏–º–µ—Ä:**
```bash
curl "http://localhost:8000/prices?ticker=BTC_USD&limit=10"
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "data": [
    {
      "id": 1,
      "ticker": "BTC_USD",
      "price": "45230.50",
      "created_at": "2026-01-21T12:00:00Z"
    }
  ],
  "total": 100
}
```

#### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ü–µ–Ω—ã

–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–∞–º–æ–π —Å–≤–µ–∂–µ–π —Ü–µ–Ω—ã –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–∏–∫–µ—Ä–∞.

```http
GET /prices/latest?ticker={TICKER}
```

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `ticker` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π): `BTC_USD` –∏–ª–∏ `ETH_USD`

**–ü—Ä–∏–º–µ—Ä:**
```bash
curl "http://localhost:8000/prices/latest?ticker=BTC_USD"
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "id": 150,
  "ticker": "BTC_USD",
  "price": "45230.50",
  "created_at": "2026-01-21T12:00:00Z"
}
```

#### 3. –°–æ–∑–¥–∞–Ω–∏–µ —Ü–µ–Ω—ã (–†—É—á–Ω–æ–π –≤–≤–æ–¥)

–†—É—á–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –æ —Ü–µ–Ω–µ.

```http
POST /prices
```

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "ticker": "BTC_USD",
  "price": "45230.50"
}
```

**–ü—Ä–∏–º–µ—Ä:**
```bash
curl -X POST "http://localhost:8000/prices" \
  -H "Content-Type: application/json" \
  -d '{"ticker": "BTC_USD", "price": "45230.50"}'
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "id": 151,
  "ticker": "BTC_USD",
  "price": "45230.50",
  "created_at": "2026-01-21T12:01:00Z"
}
```

### –ü—Ä–∏–º–µ—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –¥–∞—Ç–µ

–ü–æ–ª—É—á–µ–Ω–∏–µ —Ü–µ–Ω —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –¥–∞—Ç—ã:
```bash
curl "http://localhost:8000/prices?ticker=BTC_USD&date_from=2026-01-20T00:00:00Z"
```

–ü–æ–ª—É—á–µ–Ω–∏–µ —Ü–µ–Ω –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ –¥–∞—Ç:
```bash
curl "http://localhost:8000/prices?ticker=BTC_USD&date_from=2026-01-20T00:00:00Z&date_to=2026-01-21T23:59:59Z"
```

## –î–∏–∑–∞–π–Ω —Ä–µ—à–µ–Ω–∏—è

### 1. –°–ª–æ–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

**–†–µ—à–µ–Ω–∏–µ**: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —á–∏—Å—Ç—É—é —Å–ª–æ–∏—Å—Ç—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Å —á–µ—Ç–∫–∏–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏.

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ**:
- **API —Å–ª–æ–π** (`app/api/`): –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç HTTP –∑–∞–ø—Ä–æ—Å—ã, –≤–∞–ª–∏–¥–∞—Ü–∏—é –∏ –æ—Ç–≤–µ—Ç—ã. –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –æ—Å—Ç–∞—é—Ç—Å—è —Ç–æ–Ω–∫–∏–º–∏, –¥–µ–ª–µ–≥–∏—Ä—É—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É —Å–µ—Ä–≤–∏—Å–∞–º.
- **–°–ª–æ–π —Å–µ—Ä–≤–∏—Å–æ–≤** (`app/services/`): –°–æ–¥–µ—Ä–∂–∏—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –∏ –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ –º–µ–∂–¥—É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º–∏. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —á–∏—Å—Ç—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è API —Å–ª–æ—è.
- **–°–ª–æ–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤** (`app/repositories/`): –ê–±—Å—Ç—Ä–∞–≥–∏—Ä—É–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö, —É–ø—Ä–æ—â–∞—è —Å–º–µ–Ω—É –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è.
- **–°–ª–æ–π –º–æ–¥–µ–ª–µ–π** (`app/models/`): –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å—Ö–µ–º—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏—Å–ø–æ–ª—å–∑—É—è SQLAlchemy ORM.
- **–°–ª–æ–π —Å—Ö–µ–º** (`app/schemas/`): –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Pydantic –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- –õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π —Å–ª–æ–π –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
- –ì–∏–±–∫–æ—Å—Ç—å –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–∞–º–µ–Ω–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö)
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–∞—è –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–∞—è –∫–æ–¥–æ–≤–∞—è –±–∞–∑–∞

### 2. –ü–∞—Ç—Ç–µ—Ä–Ω Async/Await

**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ –≤—Å–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ (FastAPI, SQLAlchemy, aiohttp).

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ**:
- FastAPI –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ ASGI (Starlette) –∏ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–µ–Ω
- –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ `asyncpg` –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –ª—É—á—à—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ
- `aiohttp` –¥–ª—è –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏—Ö HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Deribit API
- –ó–∞–¥–∞—á–∏ Celery –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±–æ—Ä–∞—á–∏–≤–∞—é—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- –õ—É—á—à–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
- –ë–æ–ª–µ–µ –≤—ã—Å–æ–∫–∞—è –ø—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –¥–ª—è I/O-bound –æ–ø–µ—Ä–∞—Ü–∏–π
- –ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–µ API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### 3. –í–Ω–µ–¥—Ä–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π FastAPI –¥–ª—è —Å–µ—Å—Å–∏–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –¥—Ä—É–≥–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ**:
- `DBManager` –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É–µ—Ç –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Å–µ—Å—Å–∏–∏
- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤–Ω–µ–¥—Ä—è—é—Ç—Å—è —á–µ—Ä–µ–∑ `Depends()`, —É–ø—Ä–æ—â–∞—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏ (commit/rollback)

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
```python
async def get_db():
    async with DBManager(session_factory=async_session_maker) as db:
        yield db

DBDep = Annotated[DBManager, Depends(get_db)]
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- –õ–µ–≥–∫–æ –º–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ —Ç–µ—Å—Ç–∞—Ö
- –ß–∏—Å—Ç–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤

### 4. –ü–∞—Ç—Ç–µ—Ä–Ω Repository

**–†–µ—à–µ–Ω–∏–µ**: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω Repository –¥–ª—è –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º.

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ**:
- –ò–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É–µ—Ç –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –≤ –∫–ª–∞—Å—Å–∞—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
- –ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å –¥–∞–Ω–Ω—ã–º–∏
- –õ–µ–≥—á–µ –¥–æ–±–∞–≤–∏—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–ª–∏ —Å–º–µ–Ω–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

**–ü—Ä–∏–º–µ—Ä**:
```python
class PricesRepository(BaseRepository):
    async def get_latest(self, ticker: str) -> PriceResponse | None:
        query = (
            select(self.model)
            .where(self.model.ticker == ticker)
            .order_by(self.model.created_at.desc())
            .limit(1)
        )
        result = await self.session.execute(query)
        return result.scalar_one_or_none()
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- –¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å –±–µ–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º
- –õ–µ–≥–∫–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ

### 5. –•—Ä–∞–Ω–µ–Ω–∏–µ Unix Timestamp

**–†–µ—à–µ–Ω–∏–µ**: –•—Ä–∞–Ω–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏ –∫–∞–∫ Unix timestamps (BigInteger) –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ datetime –¥–ª—è API –æ—Ç–≤–µ—Ç–æ–≤.

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ**:
- –ë–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ
- –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å —á–∞—Å–æ–≤—ã–º–∏ –ø–æ—è—Å–∞–º–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- –ë—ã—Å—Ç—Ä—ã–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è
- –ü—Ä–æ—Å—Ç–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º –¥–∞—Ç

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
```python
created_at: Mapped[int] = mapped_column(
    BigInteger,
    server_default=func.extract("epoch", func.now()).cast(BigInteger),
    nullable=False,
)
```

**–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ —Å—Ö–µ–º–µ**:
```python
@field_validator("created_at", mode="before")
@classmethod
def convert_unix_to_datetime(cls, v):
    if isinstance(v, int):
        return datetime.fromtimestamp(v, tz=timezone.utc)
    return v
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- –•—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ–µ –æ—Ç —á–∞—Å–æ–≤—ã—Ö –ø–æ—è—Å–æ–≤
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
- –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –≤ —Ä–∞–∑–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö

### 6. Celery —Å Redis

**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Celery —Å Redis –∫–∞–∫ –±—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –±—ç–∫–µ–Ω–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è —Ü–µ–Ω.

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ**:
- Celery Beat –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –Ω–∞–¥–µ–∂–Ω–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á
- Redis –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π, –±—ã—Å—Ç—Ä—ã–π –∏ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —ç—Ç–æ–≥–æ —Å–ª—É—á–∞—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏: API –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã, Celery - —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
- –ó–∞–¥–∞—á–∏ –º–æ–≥—É—Ç –ø–æ–≤—Ç–æ—Ä—è—Ç—å—Å—è –ø—Ä–∏ —Å–±–æ—è—Ö

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**:
```python
celery_app.conf.beat_schedule = {
    "fetch-crypto-prices-every-minute": {
        "task": "app.tasks.tasks.fetch_and_save_prices",
        "schedule": settings.CELERY_BEAT_SCHEDULE_INTERVAL,
    },
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- –ù–∞–¥–µ–∂–Ω–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á
- –ù–µ–∑–∞–≤–∏—Å–∏–º–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ API –∏ –≤–æ—Ä–∫–µ—Ä–æ–≤
- –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –ø–æ–≤—Ç–æ—Ä–æ–≤
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏

### 7. Null Pool –¥–ª—è –∑–∞–¥–∞—á Celery

**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `NullPool` –¥–ª—è SQLAlchemy engine –≤ –∑–∞–¥–∞—á–∞—Ö Celery.

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ**:
- Celery –≤–æ—Ä–∫–µ—Ä—ã - –¥–æ–ª–≥–æ–∂–∏–≤—É—â–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
- –ü—É–ª–∏–Ω–≥ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å —É—Å—Ç–∞—Ä–µ–≤—à–∏–º–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏
- –ö–∞–∂–¥–∞—è –∑–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞–µ—Ç —Å–≤–µ–∂–µ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—è —É—Ç–µ—á–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
```python
engine_null_pool = create_async_engine(
    url=settings.DB_URL, poolclass=NullPool, echo=False
)
async_session_maker_null_pool = async_sessionmaker(
    bind=engine_null_pool, expire_on_commit=False
)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å —É—Å—Ç–∞—Ä–µ–≤—à–∏–º–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏
- –ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
- –ë–æ–ª–µ–µ –ø—Ä–æ—Å—Ç–æ–π –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

### 8. –¢–∏–ø Decimal –¥–ª—è —Ü–µ–Ω

**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–∏–ø `Decimal` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π —Ü–µ–Ω.

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ**:
- –ê—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞ —Å –ø–ª–∞–≤–∞—é—â–µ–π —Ç–æ—á–∫–æ–π –Ω–µ—Ç–æ—á–Ω–∞ –¥–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- `Decimal` –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ç–æ—á–Ω–æ–µ –¥–µ—Å—è—Ç–∏—á–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ
- –ù–µ—Ç –æ—à–∏–±–æ–∫ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è –≤ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è—Ö —Ü–µ–Ω

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
```python
price: Mapped[Decimal] = mapped_column(Numeric(20, 8), nullable=False)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- –¢–æ—á–Ω—ã–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è
- –ù–µ—Ç –æ—à–∏–±–æ–∫ —Å –ø–ª–∞–≤–∞—é—â–µ–π —Ç–æ—á–∫–æ–π
- –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Å–æ–±–ª—é–¥–µ–Ω–∏—è –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π

### 9. –°–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å –Ω–∞ (ticker, created_at)

**–†–µ—à–µ–Ω–∏–µ**: –°–æ–∑–¥–∞—Ç—å —Å–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å –Ω–∞ –∫–æ–ª–æ–Ω–∫–∞—Ö `ticker` –∏ `created_at`.

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ**:
- –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ —Ñ–∏–ª—å—Ç—Ä—É—é—Ç –ø–æ ticker –∏ —Å–æ—Ä—Ç–∏—Ä—É—é—Ç –ø–æ created_at
- –°–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç —ç—Ç–∏ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∑–∞–ø—Ä–æ—Å–æ–≤
- –£–ª—É—á—à–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ü–µ–Ω—ã –∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω—É –¥–∞—Ç

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
```python
__table_args__ = (Index("ix_ticker_created_at", "ticker", "created_at"),)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- –ë–æ–ª–µ–µ –±—ã—Å—Ç—Ä–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –ø–æ–¥ –Ω–∞–∏–±–æ–ª–µ–µ —á–∞—Å—Ç—ã–µ —Å–ª—É—á–∞–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 10. Enum –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç–∏–∫–µ—Ä–∞

**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Python `Enum` –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç–∏–∫–µ—Ä–∞ –≤ API —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞—Ö.

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ**:
- –¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ç–∏–∫–µ—Ä–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è FastAPI
- –õ–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å –Ω–æ–≤—ã–º–∏ —Ç–∏–∫–µ—Ä–∞–º–∏
- –°–∞–º–æ–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É—é—â–∏–π—Å—è API

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
```python
class Ticker(str, Enum):
    BTC_USD = "BTC_USD"
    ETH_USD = "ETH_USD"
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ –Ω–∞ —ç—Ç–∞–ø–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ç–∏–∫–µ—Ä–æ–≤

### 11. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π

**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `pydantic-settings` –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è.

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ**:
- –¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `.env` —Ñ–∞–π–ª–æ–≤
- –í—ã—á–∏—Å–ª—è–µ–º—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, `DB_URL`, `REDIS_URL`)

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
```python
class Settings(BaseSettings):
    POSTGRES_HOST: str
    POSTGRES_PORT: int
    
    @property
    def DB_URL(self) -> str:
        return f"postgresql+asyncpg://{self.POSTGRES_USER}:..."
    
    model_config = SettingsConfigDict(env_file=".env")
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- –ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –õ–µ–≥–∫–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π

### 12. –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–†–µ—à–µ–Ω–∏–µ**: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é —Ç–µ—Å—Ç–æ–≤—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ —Ñ–∏–∫—Å—Ç—É—Ä—ã –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏.

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ**:
- –¢–µ—Å—Ç—ã –Ω–µ –¥–æ–ª–∂–Ω—ã –≤–ª–∏—è—Ç—å –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω –¥–∞–Ω–Ω—ã–µ
- –°–≤–µ–∂–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤
- –§–∏–∫—Å—Ç—É—Ä—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- –û—Ç–¥–µ–ª—å–Ω—ã–π `test_engine` —Å `NullPool`
- `async_test_session_maker` –¥–ª—è —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å–µ—Å—Å–∏–π
- –§–∏–∫—Å—Ç—É—Ä—ã –¥–ª—è –ø—Ä–∏–º–µ—Ä–æ–≤ –¥–∞–Ω–Ω—ã—Ö –∏ –æ—á–∏—Å—Ç–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- –ù–∞–¥–µ–∂–Ω—ã–µ, –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—ã–µ —Ç–µ—Å—Ç—ã
- –ù–µ—Ç –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤
- –ë—ã—Å—Ç—Ä–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤

### 13. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

**–†–µ—à–µ–Ω–∏–µ**: –ò–∑–±–µ–≥–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å dependency injection –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é.

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ**:
- –í—Å–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `Settings` –æ–±—ä–µ–∫—Ç–µ
- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (—Å–µ—Å—Å–∏–∏ –ë–î, –∫–ª–∏–µ–Ω—Ç—ã) –∏–Ω–∂–µ–∫—Ç—è—Ç—Å—è —á–µ—Ä–µ–∑ FastAPI DI
- Celery –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—É—é —Ñ–∞–±—Ä–∏–∫—É —Å–µ—Å—Å–∏–π –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
```python
async def get_db():
    async with DBManager(session_factory=async_session_maker) as db:
        yield db
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- –¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å –∫–æ–¥–∞
- –ù–µ—Ç —Å–∫—Ä—ã—Ç—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

### 14. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –û–û–ü –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤

**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–∏–º–µ–Ω—è—Ç—å –ø—Ä–∏–Ω—Ü–∏–ø—ã –æ–±—ä–µ–∫—Ç–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö.

**–ü—Ä–∏–º–µ—Ä—ã –≤ –∫–æ–¥–µ**:

**–ù–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ**:
```python
class BaseRepository:
    model = None
    def __init__(self, session):
        self.session = session

class PricesRepository(BaseRepository):
    model = Price
```

**–ò–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏—è**:
```python
class DeribitClient:
    def __init__(self, base_url: str | None = None):
        self.base_url = base_url or settings.DERIBIT_API_URL
    
    async def get_index_price(self, currency: str) -> Decimal:
```

**–ü–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º**:
```python
class BaseService:
    def __init__(self, db: DBManager | None = None):
        self.db = db

class PricesService(BaseService):
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- –ö–æ–¥ –ª–µ–≥—á–µ –ø–æ–Ω–∏–º–∞—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å
- –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ
- –ß–µ—Ç–∫–∏–µ –≥—Ä–∞–Ω–∏—Ü—ã –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
